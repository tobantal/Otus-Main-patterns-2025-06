# Домашнее задание №8

## Цель

Написать Endpoint для приема входящих сообщений Игровым сервером.

## Описание

Для полноценной реализации игры необходимо обеспечить двусторонний обмен данными между Игровым сервером и Агентами. Частью такого обмена будет Endpoint для приема входящих сообщений Игровым сервером.

В результате выполнения ДЗ будет получен код, основанный на паттернах системы обмена сообщениями для приема входящих сообщений от Агентов.

## Термины

**Игровой сервер** - это приложение, на котором вычисляется состояние космических боев, то есть выполняются все те команды, которые рассматривались на предыдущих занятиях.[^3]

**Агент** - это специальное приложение, на котором игрок запускает свой алгоритм управления своей командой кораблей.

## Пошаговая инструкция выполнения

### Основная задача

Задача Endpoint принять входящее сообщение от Агента, десериализовать его и передать его на обработку внутрь игрового сервера.

Прием входящих сообщений и их десериализацию скорее всего возьмут на себя те библиотеки, которыми Вы будете пользоваться.

А вот определить какому из космических боев это сообщение было адресовано (маршрутизация) и его уведомление о входящем сообщении (передача сообщения в обработку) - это то, что придется делать в рамках этого ДЗ.

### Варианты реализации Endpoint

Организовать Endpoint можно реализовать разными способами :

- Endpoint поверх Tcp/IP или UDP протокола
- Controller в web-фреймворке
- Endpoint на основе веб-сокетов
- Rest
- Подписка на получение сообщений из какого-нибудь Message Broker'а

> **Выбор варианта** не сильно отразится на остальной архитектуре, то есть концептуально будет одно и тоже, а вот у каждого варианта могут быть свои нюансы реализации.

### Шаги выполнения ДЗ

#### Шаг 1: Определить формат сообщений

Определить формат сообщений, которые отправляет Агент игровому серверу.

**Указание:** Правила во всех играх могут сильно отличаться друг от друга, поэтому нужно подумать о таком формате, который бы не зависел от текущей реализации конкретных команд.

**Рекомендуемый набор данных в сообщении:**

- `id игры` - для идентификации игры, в рамках которой это сообщение обработано
- `id игрового объекта` - для определения игрового объекта внутри игры
- `id операции` - по этому id в IoC можно будет определить команду
- `args` - вложенный json объект с параметрами операции


#### Шаг 2: Определить endpoint

Определить endpoint, который принимает входящее сообщение и конвертирует в команду `InterpretCommand`.

Endpoint должен:

- Определить игру, которой адресовано сообщение
- Создать команду `InterpretCommand`
- Поместить эту команду в очередь команд этой игры


#### Шаг 3: Реализовать команду InterpretCommand

Команда `InterpretCommand` получает всю информацию об операции, которую необходимо выполнить, параметрах и объекте.

**Задача команды** - на основе IoC контейнера создать команду для нужного объекта и поставить её в очередь команд игры.

**Пример псевдокода:**

```csharp
var obj = IoC.Resolve<UObject>("Игровые объекты", "548"); 
IoC.Resolve("Установить начальное значение скорости", obj, 2);
var cmd = IoC.Resolve<Command>("Движение по прямой", obj);
IoC.Resolve<Command>("Очередь команд", cmd).Execute();
```


### Дополнительное задание

Можно реализовать **двусторонний обмен данными** между Игровым сервером и Агентом :

- Использовать websocket, tcp/ip или любой другой способ
- Создать команду для сериализации состояния игровых объектов
- Инициировать процесс отправки данных на Агент


## Критерии оценки

| Критерий | Баллы |
| :-- | :-- |
| Задача сдана на проверку | 1 балл |
| Код компилируется без ошибок, тесты выполняются успешно | 1 балл |
| Настроен CI для автоматической проверки | 2 балла |
| **Формат сообщения описан** |  |
| - Базовое описание | 1 балл |
| - Универсальный формат, удовлетворяющий SOLID | 2 балла |
| **Реализован endpoint** |  |
| - Базовая реализация | 1 балл |
| - Эффективная реализация без race conditions | 2 балла |
| **Реализована Interpret Command** |  |
| - Базовая реализация | 1 балл |
| - Реализация, удовлетворяющая SOLID | 2 балла |

**Максимальная оценка:** 10 баллов
**Задание принимается:** при оценке не менее 7 баллов

## Компетенции

### Инструменты разработки и управления проектами

- Проектировать конструкции, устойчивые к изменениям требований


### Архитектурные паттерны и принципы

- Применять паттерны обработки сообщений

***

*Выбирайте тот вариант реализации, который считаете полезным для своих прикладных задач на работе, а не для данной игры*
