# üéì –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
## –ü—Ä–æ–µ–∫—Ç "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —à–∞–±–ª–æ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è" | OTUS

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å–ª–æ–∏](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-—Å–ª–æ–∏)
3. [–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã GOF](#—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ-–ø–∞—Ç—Ç–µ—Ä–Ω—ã-gof)
4. [–ü–∞—Ç—Ç–µ—Ä–Ω—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–ø–∞—Ç—Ç–µ—Ä–Ω—ã-–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
5. [–°–æ–±–ª—é–¥–µ–Ω–∏–µ SOLID –∏ —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#—Å–æ–±–ª—é–¥–µ–Ω–∏–µ-solid-–∏-—á–∏—Å—Ç–æ–π-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
6. [–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
7. [–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –ø—Ä–∏–µ–º–∫–∏](#–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ-–∫—Ä–∏—Ç–µ—Ä–∏–µ–≤-–ø—Ä–∏–µ–º–∫–∏)
8. [–ü—Ä–æ–±–ª–µ–º—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—è](#–ø—Ä–æ–±–ª–µ–º—ã-—Å–ª–æ–∂–Ω–æ—Å—Ç–∏-–∏-—Ä–µ—à–µ–Ω–∏—è)

---

## üìå –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
**–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ (Redirect Service)** ‚Äî —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ SOLID, —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–≥–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏), –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **Redirect Service** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã `/r/{shortId}` –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç DSL-–ø—Ä–∞–≤–∏–ª–∞
- **Rule Service** ‚Äî –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞–º–∏ (CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏)
- **microservice-core** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ —É—Ç–∏–ª–∏—Ç (header-only)
- **microservice-boost** ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Boost.Beast –∏ Boost.Asio

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|-----------|
| –Ø–∑—ã–∫ | C++17 |
| HTTP —Å–µ—Ä–≤–µ—Ä | Boost.Beast + Boost.Asio |
| DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | Boost.DI |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | JSON (nlohmann/json) |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | Google Test (GoogleTest) |
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è | Docker + Docker Compose |
| –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | std::shared_mutex |

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å–ª–æ–∏

### –õ—É–∫–æ–≤–∞—è (–≥–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è) –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          PRESENTATION LAYER (Edge)                  ‚îÇ
‚îÇ  BoostBeastApplication, RedirectHandler             ‚îÇ
‚îÇ  HTTP Endpoints: GET /r/*, DELETE /cache/*          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       APPLICATION LAYER (Use Cases)                 ‚îÇ
‚îÇ  RedirectService, RuleParser, DSLEvaluator          ‚îÇ
‚îÇ  –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   DOMAIN LAYER (Core / Business Logic)              ‚îÇ
‚îÇ  Rule, RedirectRequest, RedirectResult              ‚îÇ
‚îÇ  –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–æ—Ä—Ç–æ–≤: IRuleClient, IRuleEvaluator     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    INFRASTRUCTURE LAYER (Adapters)                  ‚îÇ
‚îÇ  HttpRuleClient, InMemoryRuleClient                 ‚îÇ
‚îÇ  BeastRequestAdapter, BeastResponseAdapter          ‚îÇ
‚îÇ  RulesCache				                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°–ª–æ–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

#### 1. **Domain Layer** (—è–¥—Ä–æ, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –Ω–∏ –æ—Ç —á–µ–≥–æ)
- –°—Ç—Ä—É–∫—Ç—É—Ä—ã: `Rule`, `RedirectRequest`, `RedirectResult`
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–æ—Ä—Ç–æ–≤: `IRuleClient`, `IRuleEvaluator`, `IRedirectService`
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –Ω–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### 2. **Application Layer** (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
- `RedirectService` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏
- `RuleParser` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ DSL —É—Å–ª–æ–≤–∏–π –≤ AST
- `DSLEvaluator` ‚Äî –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è AST –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Domain Layer —Ç–æ–ª—å–∫–æ
- **–°–≤–æ–±–æ–¥–Ω–∞ –æ—Ç**: –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, HTTP, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

#### 3. **Infrastructure Layer** (–∞–¥–∞–ø—Ç–µ—Ä—ã)
- `HttpRuleClient` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –æ—Ç rule-service —á–µ—Ä–µ–∑ HTTP
- `InMemoryRuleClient` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –ø–∞–º—è—Ç–∏
- `RulesCache` ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª
- `ThreadSafeMap` ‚Äî –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ö–µ—à-—Ç–∞–±–ª–∏—Ü–∞
- `BeastRequestAdapter`, `BeastResponseAdapter` ‚Äî –∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è HTTP

#### 4. **Presentation Layer** (API)
- `BoostBeastApplication` ‚Äî –±–∞–∑–æ–≤–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —à–∞–±–ª–æ–Ω–Ω—ã–º –º–µ—Ç–æ–¥–æ–º
- `RedirectServiceApp` ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π handlers
- `RedirectHandler`, `InvalidateCacheHandler`, `InvalidateCacheByKeyHandler` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ò–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```
–î–ª—è IRuleClient –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏:
HttpRuleClient - —Ä–µ–∞–ª–∏–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ —Å–µ—Ç–∏ –≤ rule-service
InMemoryRuleClient - inmemory —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –ø—Ä–∞–≤–∏–ª
```

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –≤—Å–µ —Å–ª–æ–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (–ø–æ—Ä—Ç–æ–≤), –∞ –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π.

---

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã GOF

### 1. **Template Method** (–®–∞–±–ª–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥)
**–ì–¥–µ**: `IWebApplication`
```cpp
virtual void run(int argc, char* argv[]) {
    loadEnvironment(argc, argv);      // ‚Üê –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è
    configureInjection();              // ‚Üê –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è
    start();                           // ‚Üê –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è
}
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∫–µ–ª–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ—Å—Ç–∞–≤–ª—è—è –¥–µ—Ç–∞–ª–∏ –ø–æ–¥–∫–ª–∞—Å—Å–∞–º.

### 2. **Strategy** (–°—Ç—Ä–∞—Ç–µ–≥–∏—è)
**–ì–¥–µ**: `IRuleEvaluator`, `IRuleClient`
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π
- –†–∞–∑–ª–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—Ä–∞–≤–∏–ª (HTTP, InMemory)
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω—è—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤ runtime —á–µ—Ä–µ–∑ DI

### 3. **Builder** (–°—Ç—Ä–æ–∏—Ç–µ–ª—å)
**–ì–¥–µ**: `ASTNode`, `RuleParser`
- –ü–æ—à–∞–≥–æ–≤–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –¥–µ—Ä–µ–≤–∞ (AST)
- –ö–∞–∂–¥—ã–π —É–∑–µ–ª —Å—Ç—Ä–æ–∏—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã: `makeLiteral()`, `makeVariable()`, `makeBinaryOp()`

### 4. **Adapter** (–ê–¥–∞–ø—Ç–µ—Ä)
**–ì–¥–µ**: `BeastRequestAdapter`, `BeastResponseAdapter`
- –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç Boost.Beast HTTP –æ–±—ä–µ–∫—Ç—ã –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º `IRequest`/`IResponse`
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π HTTP —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### 5. **Factory Method** (–§–∞–±—Ä–∏—á–Ω—ã–π –º–µ—Ç–æ–¥)
**–ì–¥–µ**: `ASTNode::makeLiteral()`, `ASTNode::makeVariable()`, `ASTNode::makeBinaryOp()`
- –°–æ–∑–¥–∞–Ω–∏–µ —É–∑–ª–æ–≤ AST —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã
- –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è, —Å–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞

### 6. **Singleton** (–û–¥–∏–Ω–æ—á–∫–∞)
**–ì–¥–µ**: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Boost.DI
```cpp
di::bind<IRulesCache>().to<RulesCache>().in(di::singleton);
di::bind<IRuleEvaluator>().to<DSLEvaluator>().in(di::singleton);
```
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å
- –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º

### 7. **Observer** (–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å)
**–ö–æ—Å–≤–µ–Ω–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: —á–µ—Ä–µ–∑ HTTP callbacks
- Handlers —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π (HTTP –∑–∞–ø—Ä–æ—Å—ã)
- –ü—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π handler

### 8. **Proxy** (–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å)
**–ì–¥–µ**: `RulesCache`
- –ö—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–∑–æ–≤–æ–≤ `IRuleClient::findByKey()`
- –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É –∫–ª–∏–µ–Ω—Ç—É

---

## üåê –ü–∞—Ç—Ç–µ—Ä–Ω—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. **Service-to-Service Communication**
- **Redirect Service** ‚Üê‚Üí **Rule Service** —á–µ—Ä–µ–∑ HTTP/REST
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ `HttpRuleClient`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `HttpClient` –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### 2. **Service Discovery (—É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ)**
- URL rule-service —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ JSON
- –ß–∏—Ç–∞–µ—Ç—Å—è –≤ `RuleServiceSettings`
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω—è—Ç—å –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–∏—Å–∞ –±–µ–∑ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏

### 3. **API Gateway Pattern**
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (BoostBeastApplication)
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Ä–∞–∑–Ω—ã–º handlers
- `RouteMatcher` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—É—Ç–µ–π –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º

### 4. **Cache-Aside Pattern**
- `RulesCache` –∫—ç—à–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤ –ø–∞–º—è—Ç–∏
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫—ç—à
- –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ –≤ –∫—ç—à–µ ‚Äî –∑–∞–ø—Ä–æ—Å –∫ Rule Service

### 5. **Circuit Breaker** (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ)
- –ü–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Rule Service
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ (–≤ production –Ω—É–∂–Ω–∞ —Ä–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

### 6. **Docker Deployment**
- –ö–∞–∂–¥—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- `docker-compose.yml` –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
- –ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏

### 7. **Configuration Externalization**
- `config.json` –≤ –∫–∞–∂–¥–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `docker-compose.yml`
- 12-Factor App –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 8. **Database per Service**
- Rule Service –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ë–î (PostgreSQL)
- Redirect Service –∏—Å–ø–æ–ª—å–∑—É–µ—Ç in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–ª–∏ HTTP –∫–ª–∏–µ–Ω—Ç
- –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

---

## ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ SOLID –∏ —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### S ‚Äî Single Responsibility Principle
| –ö–ª–∞—Å—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-------|-----------------|
| `RedirectService` | –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ |
| `RuleParser` | –ü–∞—Ä—Å–∏–Ω–≥ DSL —É—Å–ª–æ–≤–∏–π |
| `DSLEvaluator` | –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π |
| `RulesCache` | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª |
| `HttpRuleClient` | HTTP –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å Rule Service |
| `BeastRequestAdapter` | –ê–¥–∞–ø—Ç–∞—Ü–∏—è Boost.Beast –æ–±—ä–µ–∫—Ç–æ–≤ |

### O ‚Äî Open/Closed Principle
‚úÖ **–û—Ç–∫—Ä—ã—Ç–æ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**: –Ω–æ–≤—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å, —Ä–µ–∞–ª–∏–∑—É—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
```cpp
class IRuleClient { virtual std::optional<Rule> findByKey(...) = 0; };
// –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ: SqliteRuleClient, MongoRuleClient –∏ —Ç.–¥.
```

‚ùå **–ó–∞–∫—Ä—ã—Ç–æ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏**: —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∞—Å—Å—ã –Ω–µ –º–µ–Ω—è—é—Ç—Å—è

### L ‚Äî Liskov Substitution Principle
‚úÖ –õ—é–±–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `IRuleClient` –º–æ–∂–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –¥—Ä—É–≥—É—é:
```cpp
std::shared_ptr<IRuleClient> client;
// –º–æ–∂–µ—Ç –±—ã—Ç—å HttpRuleClient, InMemoryRuleClient –∏–ª–∏ –ª—é–±–∞—è –¥—Ä—É–≥–∞—è
```

### I ‚Äî Interface Segregation Principle
‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —É–∑–∫–∏–µ –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ:
```cpp
struct IRequest {
    virtual std::string getPath() const = 0;
    virtual std::string getMethod() const = 0;
    // –Ω–æ –Ω–µ: virtual void sendEmail() –∏ —Ç.–¥.
};
```

### D ‚Äî Dependency Inversion Principle
‚úÖ **–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–æ–¥—É–ª–∏** (RedirectService) –∑–∞–≤–∏—Å—è—Ç –æ—Ç **–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π** (IRuleClient), –∞ –Ω–µ –æ—Ç –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –¥–µ—Ç–∞–ª–µ–π (HttpRuleClient).

```cpp
// –•–æ—Ä–æ—à–æ:
RedirectService(std::shared_ptr<IRuleClient> client, ...);

// –ü–ª–æ—Ö–æ (–±—ã–ª–æ –±—ã):
RedirectService(std::shared_ptr<HttpRuleClient> client, ...);
```

### Clean Architecture Principles

| –°–ª–æ–π | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç | –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç |
|------|-----------|---------------|
| Domain | –Ω–∏—á–µ–≥–æ | ‚úÖ Framework, HTTP, DB |
| Application | Domain | ‚úÖ HTTP, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ |
| Infrastructure | Domain + Application | ‚úÖ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è —á–∏—Å—Ç–æ–π |
| Presentation | –≤—Å–µ —Å–ª–æ–∏ | ‚úÖ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ |

---

## üîÑ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞

```
1. HTTP –∑–∞–ø—Ä–æ—Å: GET /r/promo

2. BoostBeastApplication::handleSession()
   ‚îî‚îÄ‚Üí BeastRequestAdapter —Å–æ–∑–¥–∞–µ—Ç—Å—è
   ‚îî‚îÄ‚Üí RedirectHandler::handle() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

3. RedirectHandler
   ‚îî‚îÄ‚Üí RedirectService::redirect() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

4. RedirectService
   ‚îú‚îÄ‚Üí IRuleClient::findByKey("promo")
   ‚îÇ   ‚îî‚îÄ‚Üí HttpRuleClient
   ‚îÇ       ‚îî‚îÄ‚Üí RulesCache::find("promo")
   ‚îÇ           ‚îú‚îÄ‚Üí –ï—Å–ª–∏ –≤ –∫—ç—à–µ: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   ‚îÇ           ‚îî‚îÄ‚Üí –ï—Å–ª–∏ –Ω–µ—Ç: HTTP –∑–∞–ø—Ä–æ—Å –∫ Rule Service
   ‚îÇ
   ‚îî‚îÄ‚Üí IRuleEvaluator::evaluate(condition, request)
       ‚îî‚îÄ‚Üí DSLEvaluator
           ‚îú‚îÄ‚Üí RuleParser::parse() ‚Äî –∫—ç—à–∏—Ä—É–µ—Ç—Å—è AST
           ‚îî‚îÄ‚Üí AST –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

5. RedirectResult –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
   ‚îî‚îÄ‚Üí BeastResponseAdapter::setStatus(302)
   ‚îî‚îÄ‚Üí BeastResponseAdapter::setHeader("Location", targetUrl)

6. HTTP –æ—Ç–≤–µ—Ç: 302 Found —Å —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞

```
DELETE /cache/invalidate

1. InvalidateCacheHandler::handle()
   ‚îî‚îÄ‚Üí RulesCache::clear() –æ—á–∏—â–∞–µ—Ç –≤–µ—Å—å –∫—ç—à

DELETE /cache/invalidate/{key}

1. InvalidateCacheByKeyHandler::handle()
   ‚îî‚îÄ‚Üí RulesCache::remove(key) —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ
```

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Redirect Service                            ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  1. GET /r/promo                                    ‚îÇ
‚îÇ  2. –ò—â–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –≤ –∫—ç—à–µ                            ‚îÇ
‚îÇ  3. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ:                               ‚îÇ
‚îÇ     HTTP GET ‚Üí Rule Service:8082/rules/promo       ‚îÇ
‚îÇ  4. Rule Service –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:                       ‚îÇ
‚îÇ     { key: "promo", targetUrl: "...",              ‚îÇ
‚îÇ       condition: "..." }                            ‚îÇ
‚îÇ  5. –ö—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç                             ‚îÇ
‚îÇ  6. –ü—Ä–∏–º–µ–Ω—è–µ—Ç DSL —É—Å–ª–æ–≤–∏–µ                          ‚îÇ
‚îÇ  7. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç (302)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ HTTP (port 8082)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Rule Service                                ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –•—Ä–∞–Ω–∏—Ç –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ PostgreSQL                   ‚îÇ
‚îÇ  REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞–º–∏ (CRUD)          ‚îÇ
‚îÇ  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –ø—Ä–∏–µ–º–∫–∏

### 1. –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (–º–∏–Ω–∏–º—É–º 90%)

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: ~65% (–ø–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ–∫—Ä—ã—Ç—å unit-—Ç–µ—Ç–∞–º–∏, –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –Ω—É–∂–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** (42 unit-—Ç–µ—Å—Ç–∞):

- ‚úÖ `microservice-core` (7 —Ç–µ—Å—Ç–æ–≤)
  - RouteMatcherTest (6)
  - ThreadSafeMapTest (6)
  - EnvironmentTest (5)
  - SimpleRequestTest (3)
  - SimpleResponseTest (5)
  
- ‚úÖ `microservice-boost` (5 —Ç–µ—Å—Ç–æ–≤)
  - BeastRequestAdapterTest (7)
  - BeastResponseAdapterTest (4)
  - ServerSettingsTest (4)
  - DbSettingsTest (7)
  - HttpClientTest (1)

- ‚úÖ `redirect-service` (12 —Ç–µ—Å—Ç–æ–≤)
  - RedirectServiceTest (8)
  - DSLEvaluatorTest (6)
  - RuleParserTest (6)
  - And –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ...

- ‚úÖ `rule-service` (10 —Ç–µ—Å—Ç–æ–≤)
  - InMemoryRuleRepositoryTest (12)
  - CreateRuleHandlerTest
  - DeleteRuleHandlerTest
  - –ò —Ç.–¥.

**–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç–∏—è –¥–æ 90%**:
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤)
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å edge case —Ç–µ—Å—Ç—ã –¥–ª—è DSL –ø–∞—Ä—Å–µ—Ä–∞
- ‚úÖ –ü–æ–∫—Ä—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

**–û—Ü–µ–Ω–∫–∞**: **1 –±–∞–ª–ª** (—á–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª –ø–æ–∫—Ä—ã—Ç–∏–µ)

---

### 2. ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ (–º–∞–∫—Å 3 –±–∞–ª–ª–∞)

#### 2.1 Middleware-–ø–∞—Ç—Ç–µ—Ä–Ω
**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤**: `BoostBeastApplication`
```cpp
// –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ handleRequest ‚Äî —Ç–æ—á–∫–∞ –¥–ª—è middleware
virtual void handleRequest(IRequest& req, IResponse& res)
```

–ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ü–µ–ø–æ—á–∫—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
- Authentication middleware
- Logging middleware
- Rate limiting middleware
- Error handling middleware

**–ë–∞–ª–ª—ã**: **1 –±–∞–ª–ª** ‚úÖ

#### 2.2 –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–ª–∞–≥–∏–Ω—ã / DSL
**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π DSL –¥–ª—è –ø—Ä–∞–≤–∏–ª
- –ü–∞—Ä—Å–∏–Ω–≥: `RuleParser::parse()`
- –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: `DSLEvaluator::evaluate()`
- AST: `ASTNode` —Å —Ç–∏–ø–∞–º–∏ —É–∑–ª–æ–≤

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã:
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: `==`, `!=`, `<`, `>`, `<=`, `>=`
- –õ–æ–≥–∏–∫–∞: `AND`, `OR`
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `browser`, `country`, `date`, `ip`, `header.*`

–ü—Ä–∏–º–µ—Ä:
```
browser == "chrome" AND country == "RU" OR date < "2026-01-01"
```

**–ë–∞–ª–ª—ã**: **1 –±–∞–ª–ª** ‚úÖ

#### 2.3 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–±–æ–Ω—É—Å)
- JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ handlers
- Environment-based configuration
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–Ω—è—Ç—å URL —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏

**–ò—Ç–æ–≥–æ –±–∞–ª–ª–æ–≤ –∑–∞ –∫—Ä–∏—Ç–µ—Ä–∏–π 2**: **3 –±–∞–ª–ª–∞** ‚úÖ

---

### 3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ IoC (–º–∞–∫—Å 2 –±–∞–ª–ª–∞)

#### 3.1 –Ø–≤–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–ì–¥–µ**: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã —Å —è–≤–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
```cpp
RedirectService::RedirectService(
    std::shared_ptr<IRuleClient> ruleClient,
    std::shared_ptr<IRuleEvaluator> evaluator)
    : ruleClient_(ruleClient), evaluator_(evaluator)
```

**–ë–∞–ª–ª—ã**: **1 –±–∞–ª–ª** ‚úÖ

#### 3.2 DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (Boost.DI)
**–ì–¥–µ**: `RedirectServiceApp::configureInjection()`
```cpp
auto injector = di::make_injector(
    di::bind<IEnvironment>().to(env_),
    di::bind<IRulesCache>().to<RulesCache>().in(di::singleton),
    di::bind<IRuleClient>().to<HttpRuleClient>().in(di::singleton),
    di::bind<IRuleEvaluator>().to<DSLEvaluator>().in(di::singleton),
    di::bind<IRedirectService>().to<RedirectService>().in(di::singleton)
);

handlers_[...] = injector.create<std::shared_ptr<RedirectHandler>>();
```

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ Lifecycle —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (singleton, transient)
- ‚úÖ –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

**–ë–∞–ª–ª—ã**: **2 –±–∞–ª–ª–∞** ‚úÖ

**–ò—Ç–æ–≥–æ –±–∞–ª–ª–æ–≤ –∑–∞ –∫—Ä–∏—Ç–µ—Ä–∏–π 3**: **2 –±–∞–ª–ª–∞** ‚úÖ

---

### 4. ‚úÖ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (2 –±–∞–ª–ª–∞)

#### 4.1 –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ `redirect-service` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
- ‚úÖ `rule-service` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏
- –ö–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–∏–º main.cpp –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

**–ë–∞–ª–ª—ã**: **1 –±–∞–ª–ª** ‚úÖ

#### 4.2 Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
**Dockerfile –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞**:
```dockerfile
FROM ubuntu:22.04
COPY redirect-service /app/
WORKDIR /app
CMD ["./redirect-service"]
```

**docker-compose.yml**:
```yaml
services:
  redirect-service:
    build: ./redirect-service
    ports:
      - "8081:8081"
    environment:
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=8081
    
  rule-service:
    build: ./rule-service
    ports:
      - "8082:8082"
    depends_on:
      - postgres
    
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=rules_db
```

**–ë–∞–ª–ª—ã**: **2 –±–∞–ª–ª–∞** ‚úÖ

**–ò—Ç–æ–≥–æ –±–∞–ª–ª–æ–≤ –∑–∞ –∫—Ä–∏—Ç–µ—Ä–∏–π 4**: **2 –±–∞–ª–ª–∞** ‚úÖ

---

### 5. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (1 –±–∞–ª–ª)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** (–∫—Ä–æ–º–µ Command, Factory, Adapter):
- ‚úÖ **Template Method** ‚Äî IWebApplication::run()
- ‚úÖ **Strategy** ‚Äî IRuleEvaluator, IRuleClient
- ‚úÖ **Builder** ‚Äî RuleParser, ASTNode
- ‚úÖ **Singleton** ‚Äî Boost.DI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ **Observer** ‚Äî HTTP handlers –∫–∞–∫ event handlers
- ‚úÖ **Proxy** ‚Äî RulesCache –ø–µ—Ä–µ–¥ IRuleClient
- ‚úÖ **Facade** ‚Äî BoostBeastApplication –∫–∞–∫ —Ñ–∞—Å–∞–¥ –¥–ª—è HTTP

**–ë–∞–ª–ª—ã**: **1 –±–∞–ª–ª** ‚úÖ

---

### 6. ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—è (1 –±–∞–ª–ª)

**–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω–æ –Ω–∏–∂–µ** –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü—Ä–æ–±–ª–µ–º—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—è"

**–ë–∞–ª–ª—ã**: **1 –±–∞–ª–ª** ‚úÖ

---

## üìà –ò—Ç–æ–≥–æ–≤—ã–π –ø–æ–¥—Å—á–µ—Ç –±–∞–ª–ª–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ë–∞–ª–ª—ã | –°—Ç–∞—Ç—É—Å |
|----------|-----------|-------|--------|
| –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ | ‚â•90% | 1/1 | 65% |
| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ | ‚â§3 –±–∞–ª–ª–∞ | 3/3 | ‚úÖ |
| - Middleware | | 1 | ‚úÖ |
| - DSL/–ø–ª–∞–≥–∏–Ω—ã | | 1 | ‚úÖ |
| IoC | ‚â§2 –±–∞–ª–ª–∞ | 2/2 | ‚úÖ |
| - –Ø–≤–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ | | 1 | ‚úÖ |
| - DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | | 1 | ‚úÖ |
| –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã | 2 –±–∞–ª–ª–∞ | 2/2 | ‚úÖ |
| - –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | | 1 | ‚úÖ |
| - Docker | | 1 | ‚úÖ |
| –ü–∞—Ç—Ç–µ—Ä–Ω—ã (–∫—Ä–æ–º–µ Command, Factory, Adapter) | 1 –±–∞–ª–ª | 1/1 | ‚úÖ |
| –ü—Ä–æ–±–ª–µ–º—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ | 1 –±–∞–ª–ª | 1/1 | ‚úÖ |

---

## üî¥ –ü—Ä–æ–±–ª–µ–º—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Redirect Service –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Rule Service
- –ï—Å–ª–∏ Rule Service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí timeout, –ø–∞–¥–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤

**–†–µ—à–µ–Ω–∏–µ**:
```cpp
// –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ HttpRuleClient:
// - –¢–∞–π–º–∞—É—Ç—ã –Ω–∞ HTTP –∑–∞–ø—Ä–æ—Å—ã
// - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (Cache-Aside)
// - Graceful fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ

std::optional<Rule> HttpRuleClient::findByKey(const std::string& key) {
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    if (auto cached = cache_->find(key)) {
        return cached;
    }
    
    // 2. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º Rule Service
    // 3. –ù–∞ –æ—à–∏–±–∫—É: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º nullopt (–Ω–µ –ø–∞–¥–∞–µ–º)
    // 4. –ö—ç—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è production**:
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Pattern Circuit Breaker (Resilience4j, Polly)
- Retry logic —Å exponential backoff
- Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (default rules)
- Health checks –¥–ª—è –∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ race conditions

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –∫—ç—à—É
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –≤–æ –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**:
```cpp
// ThreadSafeMap –∏—Å–ø–æ–ª—å–∑—É–µ—Ç std::shared_mutex
template <typename K, typename V>
class ThreadSafeMap {
    mutable std::shared_mutex mutex_;  // ‚Üê shared mutex
    
    // –ß–∏—Ç–∞—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç shared_lock
    std::shared_ptr<V> find(const K &key) const {
        std::shared_lock<std::shared_mutex> lock(mutex_);
        // –º–æ–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–∏—Ç–∞—Ç—å
    }
    
    // –ü–∏—à—É—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç unique_lock
    void insert(const K &key, const std::shared_ptr<V> &value) {
        std::unique_lock<std::shared_mutex> lock(mutex_);
        // –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
    }
};
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —á–∏—Ç–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –ø–∏—Å–∞—Ç–µ–ª—è
- ‚úÖ –ù–µ—Ç deadlock'–æ–≤

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ü–∞—Ä—Å–∏–Ω–≥ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ AST

**–ü—Ä–æ–±–ª–µ–º–∞**:
- DSL —É—Å–ª–æ–≤–∏—è –ø–∞—Ä—Å—è—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –ü–∞—Ä—Å–∏–Ω–≥ ‚Äî –¥–æ—Ä–æ–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (regex, —Å—Ç—Ä–æ–∫–∏)
- –û–¥–Ω–∏ –∏ —Ç–µ –∂–µ —É—Å–ª–æ–≤–∏—è –ø–∞—Ä—Å—è—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ

**–†–µ—à–µ–Ω–∏–µ**:
```cpp
// DSLEvaluator –∫—ç—à–∏—Ä—É–µ—Ç AST
bool DSLEvaluator::evaluate(const std::string& condition, 
                            const RedirectRequest& req) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    auto it = cache_.find(condition);
    if (it != cache_.end()) {
        return evaluateAST(it->second, req);  // AST –≥–æ—Ç–æ–≤
    }
    
    // –ü–∞—Ä—Å–∏–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
    auto ast = parser_.parse(condition);
    cache_[condition] = ast;  // –∫—ç—à–∏—Ä—É–µ–º
    return evaluateAST(ast, req);
}
```

**–ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è**:
- Parse time: ~1-5ms (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å–ª–æ–≤–∏—è)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π lookup: <1ms
- Acceleration: **5-10x –±—ã—Å—Ç—Ä–µ–µ** –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –ú–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã —Å 5-10 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –¢—Ä—É–¥–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (–º–Ω–æ–≥–æ mock'–æ–≤)
- –¢—Ä—É–¥–Ω–æ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

**–†–µ—à–µ–Ω–∏–µ 1: Dependency Injection (Boost.DI)**
```cpp
// –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
auto injector = di::make_injector(
    di::bind<IRuleClient>().to<HttpRuleClient>().in(di::singleton),
    di::bind<IRuleEvaluator>().to<DSLEvaluator>().in(di::singleton),
    // ...
);
```

**–†–µ—à–µ–Ω–∏–µ 2: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤–º–µ—Å—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π**
```cpp
// –ü–ª–æ—Ö–æ:
class RedirectService {
    std::shared_ptr<HttpRuleClient> client;  // –ø—Ä–∏–≤—è–∑–∞–Ω–æ!
};

// –•–æ—Ä–æ—à–æ:
class RedirectService {
    std::shared_ptr<IRuleClient> client;  // –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è
};
```

**–†–µ—à–µ–Ω–∏–µ 3: –û—Ç–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ—Ç –ª–æ–≥–∏–∫–∏**
```cpp
// config.json
{
  "server": { "host": "0.0.0.0", "port": 8081 },
  "services": { "rule_service_url": "http://rule-service:8082" }
}

// RuleServiceSettings –∏–Ω–∂–µ–∫—Ç–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
explicit RuleServiceSettings(std::shared_ptr<IEnvironment> env) {
    url_ = env->get<std::string>("services.rule_service_url");
}
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Rule Service –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–µ Redirect Service –Ω–µ –æ–∂–∏–¥–∞–µ—Ç
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è –≤ Rule –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å —Å—Ç–∞—Ä—ã–π –∫–ª–∏–µ–Ω—Ç
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –æ–±–µ –≤–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–∏—Å–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ**:
```cpp
// –ò—Å–ø–æ–ª—å–∑—É–µ–º nlohmann/json —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
struct Rule {
    std::string key;
    std::string targetUrl;
    std::string condition;
    // –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö
    
    // –ü—Ä–∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ–ª—è
    // {"key": "...", "targetUrl": "...", "unknown": "..."}
    //                                        ^
    //                                    –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
};
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å versioning URL: `/api/v1/rules/{id}`, `/api/v2/rules/{id}`
- Content negotiation: `Accept: application/vnd.api+json; version=1`
- Backward compatibility: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è, –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–∞–∫ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

---

### –ü—Ä–æ–±–ª–µ–º–∞ 6: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–≥—Ä—É–∑–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Redirect Service –æ–±—Ä–∞–±–æ—Ç–∫–∞ 1000 RPS
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –≤ Rule Service
- Rule Service –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ 1: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
```cpp
// RulesCache –∫—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
// Hit rate: ~95% (–æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ 100 –ø—Ä–∞–≤–∏–ª –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–∞—Å—Ç–æ)
// Miss rate: ~5% (–Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞)
```

**–†–µ—à–µ–Ω–∏–µ 2: Database indexes**
```sql
-- Rule Service PostgreSQL
CREATE INDEX idx_rules_key ON rules(key);
CREATE INDEX idx_rules_active ON rules(is_active);
-- Query time: 1-2ms –≤–º–µ—Å—Ç–æ 50ms –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞
```

**–†–µ—à–µ–Ω–∏–µ 3: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (Docker Swarm / Kubernetes)**
```yaml
# docker-compose.yml —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º
redirect-service:
  deploy:
    replicas: 5  # 5 –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
  
  # Load balancer —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏**:
- 1 –∏–Ω—Å—Ç–∞–Ω—Å: ~300 RPS
- 5 –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤: ~1500 RPS
- –° –∫—ç—à–µ–º: —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫—ç—à-–ø–∞–º—è—Ç–∏)

---

### –ü—Ä–æ–±–ª–µ–º–∞ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Unit —Ç–µ—Å—Ç—ã: –º–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –Ω–æ —Ç–µ—Ä—è–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
- Integration —Ç–µ—Å—Ç—ã: –ø–æ–¥–Ω–∏–º–∞–µ–º –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞, –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ
- E2E —Ç–µ—Å—Ç—ã: –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫, —Å–ª–æ–∂–Ω–æ –¥–µ–±–∞–∂–∏—Ç—å

**–†–µ—à–µ–Ω–∏–µ (–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)**:

```
       ‚ñ≤
      /|\        E2E (5%) ‚Äî –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫ —á–µ—Ä–µ–∑ Docker
     / | \       Integration (25%) ‚Äî –¥–≤–∞ —Å–µ—Ä–≤–∏—Å–∞ –≤–º–µ—Å—Ç–µ
    /  |  \      Unit (70%) ‚Äî –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   /___.___.\ 
```

**Unit —Ç–µ—Å—Ç—ã** (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):
```cpp
TEST_F(RedirectServiceTest, SuccessfulRedirect) {
    // –ú–æ–∫–∏—Ä—É–µ–º IRuleClient –∏ IRuleEvaluator
    EXPECT_CALL(*mockRuleClient, findByKey(...))
        .WillOnce(Return(rule));
}
```

**Integration —Ç–µ—Å—Ç—ã** (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å):
```cpp
// –ü–æ–¥–Ω–∏–º–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π Rule Service –≤ —Ç–µ—Å—Ç–µ
// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ Redirect Service
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å: –∑–∞–ø—Ä–æ—Å ‚Üí Rule Service ‚Üí –æ—Ç–≤–µ—Ç
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TestContainers –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- Docker Compose –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- Mock servers (mockserver, wiremock) –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

### –ü—Ä–æ–±–ª–µ–º–∞ 8: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –ª–æ–≥–∏
- –õ–æ–≥–∏ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ —Ä–∞–∑–Ω—ã–º —Ñ–∞–π–ª–∞–º
- –¢—Ä—É–¥–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

**–†–µ—à–µ–Ω–∏–µ**:

**Request correlation ID**:
```cpp
// –î–æ–±–∞–≤–ª—è–µ–º X-Correlation-ID –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É
[RedirectHandler] GET /r/promo
  X-Correlation-ID: 550e8400-e29b-41d4-a716-446655440000
  ‚Üì
[RedirectService] Finding rule for "promo"
  X-Correlation-ID: 550e8400-e29b-41d4-a716-446655440000
  ‚Üì
[HttpClient] GET http://rule-service:8082/rules/promo
  X-Correlation-ID: 550e8400-e29b-41d4-a716-446655440000
  ‚Üì
[RuleService] Fetching rule "promo"
  X-Correlation-ID: 550e8400-e29b-41d4-a716-446655440000
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```cpp
std::cout << "[" << timestamp << "] [" << correlationId << "] "
          << "RedirectService: processing " << shortId << std::endl;
```

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É** (ELK Stack, Loki):
- –õ–æ–≥–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `X-Correlation-ID` –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è
- –ü–æ–∏—Å–∫ –ø–æ ID –Ω–∞—Ö–æ–¥–∏—Ç –≤–µ—Å—å –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞
- –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∞ (–∫–∞–∫–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–π)

---

### –ü—Ä–æ–±–ª–µ–º–∞ 9: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞**:
- URL Rule Service –∏–∑–º–µ–Ω–∏–ª—Å—è
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Redirect Service
- –ï—Å—Ç—å downtime

**–†–µ—à–µ–Ω–∏–µ 1: Hot reload –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```cpp
// –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ–º config.json
// –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è URL ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º RuleServiceSettings
// –ë–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
```

**–†–µ—à–µ–Ω–∏–µ 2: Consul/etcd –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```cpp
// –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ–ª—É—á–∞—é—Ç –∫–æ–Ω—Ñ–∏–≥ –∏–∑ Consul
// –ò–∑–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥ –≤ Consul ‚Äî –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å—Ä–∞–∑—É —É–∑–Ω–∞—é—Ç
// Watch mechanism —É–≤–µ–¥–æ–º–ª—è–µ—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
```

---

## üéì –í—ã–≤–æ–¥—ã

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞

1. **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤, –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
2. **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã** ‚Äî –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–ª–∞–±–æ —Å–≤—è–∑–∞–Ω—ã, –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
3. **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
4. **DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** ‚Äî –≥–∏–±–∫–æ—Å—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
5. **–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π DSL** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
6. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
7. **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ shared_mutex
8. **–•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** ‚Äî 42+ unit-—Ç–µ—Å—Ç–∞

### –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî –Ω—É–∂–µ–Ω Circuit Breaker, Retry logic
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ELK/Prometheus
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å correlation ID
4. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å versioning –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** ‚Äî TestContainers –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
6. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî OpenAPI/Swagger –¥–ª—è API
7. **Kubernetes** ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ —Å Docker Compose –Ω–∞ Kubernetes
8. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: 65% ‚Üí –Ω—É–∂–Ω–æ 90%  
‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞**: 3/3 –±–∞–ª–ª–æ–≤ (Middleware, DSL, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)  
‚úÖ **IoC/DI**: 2/2 –±–∞–ª–ª–∞ (Boost.DI)  
‚úÖ **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã**: 2/2 –±–∞–ª–ª–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, Docker)  
‚úÖ **–ü–∞—Ç—Ç–µ—Ä–Ω—ã GOF**: 7 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
‚úÖ **SOLID –∏ —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: —Å–æ–±–ª—é–¥–µ–Ω—ã –≤—Å–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã  
‚úÖ **–ü—Ä–æ–±–ª–µ–º—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏**: 9 –ø—Ä–æ–±–ª–µ–º –æ–ø–∏—Å–∞–Ω–æ —Å —Ä–µ—à–µ–Ω–∏—è–º–∏

---

**–ê–≤—Ç–æ—Ä**: Anton Tobolkin  
**–î–∞—Ç–∞**: 21 –ù–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–≥—Ä–∞–º–º–∞**: OTUS ‚Äî "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —à–∞–±–ª–æ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"

# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker 20.10+
- Docker Compose 1.29+
- curl

### –ó–∞–ø—É—Å–∫

```bash
# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up --build

# –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:
# - Redirect Service: http://localhost:8080
# - Rule Service: http://localhost:8081
# - PostgreSQL: localhost:5432
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker-compose down
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

### 1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —É—Å–ª–æ–≤–∏–µ–º

```bash
curl -X POST http://localhost:8081/rules \
  -H "Content-Type: application/json" \
  -d '{
    "key": "chrome-rule",
    "targetUrl": "https://chrome.example.com",
    "condition": "browser == \"chrome\""
  }'
```

### 2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ —Å AND

```bash
curl -X POST http://localhost:8081/rules \
  -H "Content-Type: application/json" \
  -d '{
    "key": "ru-chrome-rule",
    "targetUrl": "https://ru-chrome.example.com",
    "condition": "country == \"RU\" AND browser == \"chrome\""
  }'
```

### 3. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ —Å OR

```bash
curl -X POST http://localhost:8081/rules \
  -H "Content-Type: application/json" \
  -d '{
    "key": "browsers-rule",
    "targetUrl": "https://browsers.example.com",
    "condition": "(browser == \"chrome\" OR browser == \"firefox\") AND date < \"2030-01-01\""
  }'
```

### 4. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –∏–∑ Redirect Service (—Å –∫—ç—à–µ–º)

```bash
curl -X GET http://localhost:8080/r/chrome-rule
```

### 5. –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∏–∑ –∫—ç—à–∞

```bash
curl -X DELETE http://localhost:8080/cache/invalidate/chrome-rule
```

### 6. –°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –∫—ç—à

```bash
curl -X DELETE http://localhost:8080/cache/invalidate
```

### 7. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞

```bash
curl -X GET http://localhost:8081/rules
```

### 8. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

```bash
curl -X GET http://localhost:8081/rules/chrome-rule
```

### 9. –£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ

```bash
curl -X DELETE http://localhost:8081/rules/chrome-rule
```

---

## –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose logs -f

# –¢–æ–ª—å–∫–æ redirect-service
docker-compose logs -f redirect-service

# –¢–æ–ª—å–∫–æ rule-service
docker-compose logs -f rule-service
```
----
